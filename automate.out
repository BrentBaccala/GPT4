#!/usr/bin/env python3

import getpass
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.firefox.options import Options

options = Options()
options.headless = False

driver = webdriver.Firefox(options=options)
driver.get("https://poe.com/")

# Switch to iframe and click continue
iframe = WebDriverWait(driver, 10).until(EC.presence_of_element_located((By.XPATH, '//iframe[@title="Sign in with Google Dialog"]')))
driver.switch_to.frame(iframe)

continue_button = WebDriverWait(driver, 10).until(EC.element_to_be_clickable((By.ID, "continue")))
continue_button.click()

# Switch to sign in window
WebDriverWait(driver, 10).until(EC.number_of_windows_to_be(2))
signin_window = [window for window in driver.window_handles if window != driver.current_window_handle][0]
driver.switch_to.window(signin_window)

# Enter email and click next
email_input = WebDriverWait(driver, 10).until(EC.element_to_be_clickable((By.XPATH, '//input[@type="email"]')))
email_input.send_keys("cosine@freesoft.org")

next_button = WebDriverWait(driver, 10).until(EC.element_to_be_clickable((By.XPATH, '//div[@id="identifierNext"]//button')))
next_button.click()

# Prompt for password
password = getpass.getpass(prompt="Enter your password: ")

# Enter password and click next
password_input = WebDriverWait(driver, 10).until(EC.element_to_be_clickable((By.XPATH, '//input[@type="password" and @name="Passwd"]')))
password_input.send_keys(password)

next_button = WebDriverWait(driver, 10).until(EC.element_to_be_clickable((By.XPATH, '//div[@id="passwordNext"]//button')))
next_button.click()

# Switch back to original window
driver.switch_to.window(driver.window_handles[0])

# Click on Claude+
claude = WebDriverWait(driver, 10).until(EC.element_to_be_clickable((By.XPATH, '//p[contains(text(), "Claude+")]')))
claude.click()

# Send message "count from 1 to 10"
message_input = WebDriverWait(driver, 10).until(EC.element_to_be_clickable((By.XPATH, '//textarea[@placeholder="Talk to Claude+ on Poe"]')))
message_input.send_keys("count from 1 to 10")

send_button = WebDriverWait(driver, 10).until(EC.element_to_be_clickable((By.XPATH, '//button[.//svg//path]')))
send_button.click()

# Wait 10 seconds before exiting
WebDriverWait(driver, 10).until(lambda _: False)
